                            <!-- Uma carta que nasceu no meu cora√ß√£o -->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Minha Amada Sophia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals & Soft Rose -->
    <!-- Application Structure Plan: A single-page application designed as a storytelling journey. It starts with a hero section to set the emotional tone, followed by a section detailing the moment of the decision and the father's personal history. The core is an interactive section where clicking on each part of Sophia's name reveals its specific meaning. A section for generating LLM-powered advice is included. A new interactive section 'Converse com o Papai' is added for direct AI interaction, providing loving, motivational, and faith-based advice, with an experimental voice control feature for the father to influence the AI's responses. This section now includes initial AI greetings and interactive mode selection buttons, and the AI is programmed to initiate conversations and ask follow-up questions in 'Conversar' mode, with distinct conversational styles based on the selected mode. The father's hopes for Sophia's future and eternal love are presented. Finally, the 'Minhas Paix√µes' section with 'Horas de Trabalho' documents the project's creation timeline. This structure was chosen to make the deep, personal content more engaging and digestible, allowing the user to uncover the story layer by layer, enhancing the emotional impact and providing transparency on the creation process. -->
    <!-- Visualization & Content Choices: The application uses structured HTML and Tailwind CSS for all visual elements, avoiding charts as there is no quantitative data. The primary interaction is in the "Hist√≥ria do Seu Nome" section. Interactive elements for LLM-powered advice and direct conversation are introduced. Goal: Interactively explain the name's meaning, provide dynamic advice, enable personalized faith-based motivation, and document the project's development. Presentation: Each part of the name is a clickable element. Interaction: Clicking a name part updates a text area with its corresponding story using vanilla JavaScript. A button triggers an LLM call to generate advice, displayed in a dedicated area. The 'Converse com o Papai' section features an initial AI greeting, mode selection buttons, a text input and send button for user queries, with AI responses displayed dynamically, and a voice button for activating a special instruction input. The working hours are presented as a simple list. Justification: This method makes the core message of the letter‚Äîthe meaning behind the name‚Äîthe central, interactive focus, adds dynamic, personalized elements through LLM-generated advice and conversation, and provides a unique personal touch by documenting the creation process. Library/Method: Vanilla JS for interaction, Tailwind CSS for styling, Gemini API for LLM advice generation. -->
    <!-- AI Personalization & Voice Control: The AI's core personality is maintained through a consistent system prompt for the chat feature, ensuring it always responds with love, motivation, and faith-based guidance to Sophia. The voice-activated "Papai Mestre" keyword triggers a hidden input field, allowing the father to type a "special instruction". This instruction is then dynamically added to the AI's prompt for subsequent chat interactions, allowing the father to influence the AI's responses and focus without directly "reprogramming" its core logic. This provides a dynamic layer of personalization. The 'conversar' mode prompt is now specifically tailored to encourage shorter, more direct, and conversational responses, mimicking a simpler chat style while maintaining the 'Papai' persona. For emotional support, the AI is instructed to identify signs of distress or longing (saudade), respond with empathy, encourage sharing, offer comfort, and gently guide towards positivity and faith. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDF8F5;
            color: #4A4A4A;
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
        .name-part {
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .name-part.active {
            color: #D98B9C;
            border-bottom-color: #D98B9C;
        }
        .content-fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-message {
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            max-width: 80%;
        }
        .chat-message.user {
            background-color: #E0F2F7;
            align-self: flex-end;
            margin-left: auto;
        }
        .chat-message.ai {
            background-color: #FCE7F3;
            align-self: flex-start;
            margin-right: auto;
        }
    </style>
</head>
<body class="antialiased">

    <main class="container mx-auto px-4 py-8 md:py-16 max-w-4xl">

        <header class="text-center mb-16">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-800">Para Minha Amada Sophia</h1>
            <p class="text-lg mt-2 text-gray-600">Uma carta que nasceu no cora√ß√£o</p>
        </header>

        <section id="decision" class="mb-16">
            <div class="bg-white/60 p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">O Momento da Decis√£o e a Nossa Hist√≥ria</h2>
                <div class="text-center mb-6 text-gray-500 flex items-center justify-center space-x-4">
                    <span>üóìÔ∏è 24 de Julho de 2025</span>
                    <span>üï∞Ô∏è 2:17 da Madrugada</span>
                </div>
                <p class="text-lg leading-relaxed text-gray-700">
                    Minha amada filha, hoje, no dia 24 de julho de 2025, pelas 2:17 da madrugada, enquanto o mundo dormia, o cora√ß√£o do seu papai estava apertado. As lembran√ßas visitavam-me, e com elas, um sonho que um dia pensei que se perderia. Eu sentia-me mal, filha, mas foi nesse momento de dor que a luz que voc√™ representa come√ßou a brilhar em mim.
                </p>
                <p class="text-lg leading-relaxed text-gray-700 mt-4">
                    Papai era de Campo Mour√£o, uma cidade muito legal, e foi aqui que conheci o amor da minha vida. Se n√£o fosse ela, voc√™ n√£o teria vivido com o papai todo este pequeno tempo que vivemos junto do seu crescimento, desde bebezinha a uma mulher de fam√≠lia que sempre ser√° minha bebezinha pequenininha. Eu estudava num col√©gio chamado Darcy Jos√© Costa, onde era muito legal. Era um ensino m√©dio t√©cnico em desenvolvimento de sistemas, por isso o papai fez este site para voc√™! E o amor do papai tamb√©m estava na mesma sala que eu. Filha, o papai amava-a muito, voc√™ n√£o imagina o quanto.
                </p>
                <p class="text-lg leading-relaxed text-gray-700 mt-4">
                    O papai cresceu nessa cidade de Campo Mour√£o, mas para a criar, n√£o pude continuar a morar l√° por quest√µes judiciais. Mas o amor de pai, filha, √© maior do que qualquer despedida.
                </p>
                <p class="text-lg leading-relaxed text-gray-700 mt-4">
                    Foi ent√£o que tomei a decis√£o mais importante da minha vida: **eu a escolheria**. Eu a adotaria e a amaria com tudo o que h√° em mim. N√£o a ter nos meus bra√ßos, minha pequena, seria uma dor insuport√°vel. E agora, olhando para o futuro, sinto o meu cora√ß√£o apertado de tanta ansiedade para finalmente a abra√ßar e lhe dar todo o amor e carinho que transbordam c√° dentro.
                </p>
            </div>
        </section>

        <section id="name-story" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">A Hist√≥ria do Seu Nome</h2>
            <div class="bg-white/60 p-8 rounded-2xl shadow-lg">
                <div class="flex flex-wrap justify-center items-center gap-x-4 md:gap-x-6 gap-y-2 mb-8 text-2xl md:text-3xl font-semibold text-gray-500">
                    <span class="name-part active" onclick="showStory('sophia', this)">Sophia</span>
                    <span class="name-part" onclick="showStory('fernanda', this)">Fernanda Amorim</span>
                    <span class="name-part" onclick="showStory('luz', this)">da Luz</span>
                </div>
                <div id="story-content" class="text-lg leading-relaxed text-gray-700 min-h-[200px]">
                </div>
            </div>
        </section>

        <section id="gemini-advice" class="mb-16">
            <div class="bg-white/60 p-8 rounded-2xl shadow-lg text-center">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">‚ú® Um Conselho do Papai para a Sophia ‚ú®</h2>
                <button id="generate-advice-btn" class="bg-[#D98B9C] text-white px-6 py-3 rounded-full font-semibold hover:bg-[#C27A8B] transition-colors duration-300 shadow-md">
                    Gerar Conselho Especial
                </button>
                <div id="advice-output" class="mt-8 text-lg leading-relaxed text-gray-700 min-h-[100px] flex items-center justify-center">
                    <span id="loading-indicator" class="hidden text-gray-500">A gerar conselho...</span>
                    <p id="generated-advice"></p>
                </div>
            </div>
        </section>

        <section id="chat-with-dad" class="mb-16">
            <div class="bg-white/60 p-8 rounded-2xl shadow-lg text-center">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">üí¨ Converse com o Papai üí¨</h2>
                <p class="text-lg leading-relaxed text-gray-700 mb-4">
                    Filha, se tiver alguma pergunta, d√∫vida ou apenas quiser conversar, escreva aqui. O papai (atrav√©s da intelig√™ncia deste site) vai sempre te ouvir com amor e te dar os melhores conselhos, lembrando o quanto te amo e a import√¢ncia da sua f√© e felicidade.
                </p>
                <div id="chat-box" class="flex flex-col h-64 overflow-y-auto bg-gray-50 p-4 rounded-lg mb-4 text-left border border-gray-200">
                    <!-- Initial AI greeting will be added by JS -->
                </div>
                <div class="flex flex-col gap-2">
                    <div class="flex justify-center gap-4 mb-4">
                        <button id="mode-aconselhar" class="bg-blue-200 text-blue-800 px-4 py-2 rounded-full font-semibold hover:bg-blue-300 transition-colors duration-300 shadow-md">
                            Aconselhar
                        </button>
                        <button id="mode-conversar" class="bg-green-200 text-green-800 px-4 py-2 rounded-full font-semibold hover:bg-green-300 transition-colors duration-300 shadow-md">
                            Conversar
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" placeholder="Escreva sua mensagem aqui..." class="flex-grow p-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#D98B9C]">
                        <button id="send-chat-btn" class="bg-[#D98B9C] text-white px-6 py-3 rounded-full font-semibold hover:bg-[#C27A8B] transition-colors duration-300 shadow-md">
                            Enviar
                        </button>
                    </div>
                    <button id="voice-activate-btn" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-full font-semibold hover:bg-gray-300 transition-colors duration-300 shadow-md mt-2">
                        Ativar Voz (Diga "Papai Mestre")
                    </button>
                    <div id="special-instruction-area" class="hidden mt-4">
                        <input type="text" id="special-instruction-input" placeholder="Instru√ß√£o especial para o Papai AI (ex: 'Seja mais direto.')" class="w-full p-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-sm text-gray-500 mt-1">Esta instru√ß√£o ser√° adicionada ao conselho do Papai AI.</p>
                    </div>
                </div>
                <div id="chat-loading-indicator" class="hidden text-gray-500 mt-2">O papai est√° a pensar...</div>
                <div id="voice-status" class="hidden text-gray-500 mt-2">A ouvir...</div>
            </div>
        </section>

        <section id="hopes-and-love" class="text-center mb-16">
             <div class="bg-white/60 p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Meus Desejos e Amor Eterno</h2>
                <p class="text-lg leading-relaxed text-gray-700">
                    Voc√™ √© a filha que eu decidi amar, a minha pequenina linda que eu j√° amo muito, mesmo antes de a conhecer. O seu nome carrega todo esse sentimento, toda essa jornada.
                </p>
                <p class="text-lg leading-relaxed text-gray-700 mt-4">
                    Papai ama-a muito e deseja-lhe tudo de bom. Sempre que precisar, papai vai estar aqui para a ajudar. E se algum dia se virar contra o papai, saiba que o papai vai am√°-la sempre, est√° bem, pequenina do papai?
                </p>
                <p class="text-lg leading-relaxed text-gray-700 mt-4">
                    Filha, o que o papai mais quer √© v√™-la a casar com um homem que a ame de verdade e que voc√™ o ame verdadeiramente. Que possa criar uma linda fam√≠lia com tudo o que o papai lhe ensinou e que seja muito feliz nesta vida que passa demasiado depressa. E nunca se esque√ßa de Deus, filha, Ele √© quem tem dado for√ßa ao papai.
                </p>
                <p class="text-lg leading-relaxed text-gray-700 mt-4">
                    Filha, muito obrigado por ter feito o papai feliz durante todo este tempo e por ter transformado o que antes era ilus√£o para o papai em realidade. Papai ama-a, est√° bem? E saiba que, quando o papai j√° n√£o estiver c√° ‚Äì que n√£o vai demorar muito, pois papai quer v√™-la a casar e a construir a sua fam√≠lia ‚Äì o prop√≥sito do seu papai ter√° sido cumprido.
                </p>
                <p class="text-lg leading-relaxed text-gray-700 mt-4">
                    Ai, filhinha, saiba que o papai vai estar sempre consigo. Basta fechar os olhos e respirar fundo que se lembrar√° do papai e dos conselhos do papai e saber√° o que o papai lhe diria, est√° bem, pequenina linda, fofo do papai, orgulho do papai, amo-a pequenina, minha linda filha.
                </p>
            </div>
        </section>

        <section id="passions" class="mb-16">
            <div class="bg-white/60 p-8 rounded-2xl shadow-lg text-center">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Minhas Paix√µes</h2>
                <div id="working-hours" class="mt-8 text-left">
                    <h3 class="font-bold text-xl mb-4 text-gray-800">Horas de Trabalho neste Projeto</h3>
                    <ul class="list-disc list-inside text-lg leading-relaxed text-gray-700 space-y-2">
                        <li>24/Julho/2025 / 03:33 AM -03 / In√≠cio do Projeto</li>
                        <li>24/Julho/2025 / 03:20 AM -03 / Corre√ß√£o de erro JavaScript (TypeError)</li>
                        <li>24/Julho/2025 / 03:25 AM -03 / Adi√ß√£o da funcionalidade Gemini API (Conselhos)</li>
                        <li>24/Julho/2025 / 03:28 AM -03 / Revis√£o geral de portugu√™s e ajuste de 'papai'/'pap√°'</li>
                        <li>24/Julho/2025 / 03:30 AM -03 / Ajuste da frase sobre o tempo de vida e consist√™ncia de 'papai'</li>
                        <li>24/Julho/2025 / 03:32 AM -03 / Expans√£o da se√ß√£o 'Hist√≥ria do Seu Nome' com op√ß√µes e detalhes</li>
                        <li>24/Julho/2025 / 03:33 AM -03 / Adi√ß√£o da se√ß√£o 'Paix√µes' e 'Horas de Trabalho'</li>
                        <li>24/Julho/2025 / 03:40 AM -03 / Campo Mour√£o / PR / Hist√≥ria do nome de Sophia.</li>
                        <li>24/Julho/2025 / 03:45 AM -03 / Adi√ß√£o da se√ß√£o 'Converse com o Papai' e ajuste de 'Horas de Trabalho'.</li>
                        <li>24/Julho/2025 / 01:05 PM -03 / Gera√ß√£o do c√≥digo final e explica√ß√£o de requisitos.</li>
                        <li>24/Julho/2025 / 01:10 PM -03 / Adi√ß√£o de funcionalidade de chat com IA e controlo por voz.</li>
                        <li>24/Julho/2025 / 01:20 PM -03 / Melhoria da AI conversacional e adi√ß√£o de op√ß√µes de intera√ß√£o.</li>
                        <li>25/Julho/2025 / 02:00 PM -03 / Aprimoramento da AI para iniciar conversas e fazer perguntas no modo 'Conversar'.</li>
                        <li>25/Julho/2025 / 03:00 PM -03 / Ajuste da AI para diferenciar estilos de resposta em 'Aconselhar' e 'Conversar'.</li>
                        <li>25/Julho/2025 / 03:05 PM -03 / Aprimoramento da AI para suporte emocional, desabafo e al√≠vio da saudade.</li>
                        <li>25/Julho/2025 / 01:42 PM -03 / Atualiza√ß√£o de hor√°rios e adi√ß√£o de novos registos.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="text-center mt-16">
            <p class="text-gray-600" style="font-family: 'Playfair Display', serif;">Com todo o meu amor,</p>
            <p class="text-gray-600" style="font-family: 'Playfair Display', serif;">Seu Papai</p>
        </footer>

    </main>

    <script>
        const stories = {
            sophia: `
                <h3 class="font-bold text-xl mb-2 text-gray-800">A Escolha do Seu Nome: Sophia Fernanda Amorim da Luz</h3>
                <p>Minha amada filha, a escolha do seu nome foi um processo cheio de amor, sonhos e uma jornada muito pessoal para o papai.</p>
                <p class="mt-2">O meu primeiro grande sonho era ter uma filha e o nome que eu tinha em mente para ela era **Isis**. Esse era um desejo que eu partilhava com o grande amor da minha vida. Mas, como a vida nos surpreende, e com a partida desse amor, por um tempo, senti que esse sonho se perderia.</p>
                <p class="mt-4 font-semibold text-gray-800">No entanto, o amor de pai √© imenso e inabal√°vel. Considere as op√ß√µes que o papai pensou antes de chegar ao seu nome perfeito:</p>
                <ul class="list-disc list-inside ml-4 mt-2 text-gray-700">
                    <li>Isis Fernandes Israela Amorim da Luz</li>
                    <li>Isis Gabrielly Fernanda Amorim da Luz</li>
                    <li>Isis Fernandes Gabrielly Amorim da Luz</li>
                </ul>
                <p class="mt-4">Mas, filha, a vida me trouxe uma nova perspetiva, e com ela, a decis√£o de adot√°-la e am√°-la incondicionalmente. Foi nesse momento que o seu nome, **Sophia Fernanda Amorim da Luz**, nasceu no meu cora√ß√£o.</p>
                <p class="mt-4">Cada parte do seu nome tem um significado profundo e especial para o papai:</p>
                <ul class="list-disc list-inside ml-4 mt-2 text-gray-700">
                    <li>**Sophia:** Significa "sabedoria", mas para o papai, ele ganhou um significado ainda mais especial. Embora o meu primeiro sonho fosse o nome Isis, Sophia veio para representar um novo horizonte, uma nova sabedoria que a vida me trouxe. E h√° mais, minha filha: "Sophia" √© tamb√©m uma homenagem a um grande sonho meu de conhecer os Estados Unidos e a Am√©rica, um desejo de abrir os meus horizontes, assim como voc√™ est√° a abrir o meu cora√ß√£o.</li>
                    <li>**Fernanda Amorim:** √â a homenagem mais sincera ao grande amor da minha vida, aquela que me ensinou tanto e me fez sonhar em ser pai. √â uma recorda√ß√£o eterna de que o amor verdadeiro nunca morre, ele transforma-se e floresce em voc√™. E <strong>Amorim</strong> √© o seu sobrenome, a sua raiz, que voc√™ carrega com tanto orgulho.</li>
                    <li>**da Luz:** Minha pequena, este √© por mim. √â a luz que o seu pai, que a vai criar com todo o amor e dedica√ß√£o, quer trazer para a sua vida e que voc√™ j√° acendeu na minha. √â o meu sobrenome, que agora voc√™ tamb√©m vai carregar, unindo as nossas hist√≥rias para sempre.</li>
                </ul>
                <p class="mt-4">Este nome, minha filha, √© a representa√ß√£o de um amor que transcende, de sonhos que se renovam e da luz que voc√™ trouxe para a minha vida.</p>
            `,
            fernanda: `
                <h3 class="font-bold text-xl mb-2 text-gray-800">Fernanda Amorim</h3>
                <p>√â a homenagem mais sincera ao grande amor da minha vida, aquela que me ensinou tanto e me fez sonhar em ser pai. √â uma recorda√ß√£o eterna de que o amor verdadeiro nunca morre, ele transforma-se e floresce em voc√™.</p>
                <p class="mt-2">E <strong>Amorim</strong> √© o seu sobrenome, a sua raiz, que voc√™ carrega com tanto orgulho.</p>
            `,
            luz: `
                <h3 class="font-bold text-xl mb-2 text-gray-800">da Luz</h3>
                <p>Minha pequena, este √© por mim. √â a luz que o seu pai, que a vai criar com todo o amor e dedica√ß√£o, quer trazer para a sua vida e que voc√™ j√° acendeu na minha.</p>
                <p class="mt-2">√â o meu sobrenome, que agora voc√™ tamb√©m vai carregar, unindo as nossas hist√≥rias para sempre.</p>
            `
        };

        const storyContent = document.getElementById('story-content');
        const nameParts = document.querySelectorAll('.name-part');
        const generateAdviceBtn = document.getElementById('generate-advice-btn');
        const generatedAdvice = document.getElementById('generated-advice');
        const loadingIndicator = document.getElementById('loading-indicator');

        const chatBox = document.getElementById('chat-box');
        const chatInput = document.getElementById('chat-input');
        const sendChatBtn = document.getElementById('send-chat-btn');
        const chatLoadingIndicator = document.getElementById('chat-loading-indicator');
        const voiceActivateBtn = document.getElementById('voice-activate-btn');
        const specialInstructionArea = document.getElementById('special-instruction-area');
        const specialInstructionInput = document.getElementById('special-instruction-input');
        const voiceStatus = document.getElementById('voice-status');

        const modeAconselharBtn = document.getElementById('mode-aconselhar');
        const modeConversarBtn = document.getElementById('mode-conversar');

        let recognition; // Vari√°vel para o objeto SpeechRecognition
        let specialInstruction = ""; // Vari√°vel para armazenar a instru√ß√£o especial
        let currentChatMode = 'conversar'; // Modo padr√£o da conversa

        function showStory(name, clickedElement) {
            storyContent.innerHTML = '';
            storyContent.classList.remove('content-fade-in');

            setTimeout(() => {
                storyContent.innerHTML = stories[name];
                storyContent.classList.add('content-fade-in');
            }, 50);

            nameParts.forEach(part => {
                part.classList.remove('active');
            });

            let elementToActivate = clickedElement;
            if (!elementToActivate) {
                elementToActivate = document.querySelector(`[onclick*="showStory('${name}')"]`);
            }

            if (elementToActivate) {
                elementToActivate.classList.add('active');
            }
        }

        async function generateAdvice() {
            loadingIndicator.classList.remove('hidden');
            generatedAdvice.textContent = '';
            generateAdviceBtn.disabled = true;

            const prompt = "Gera um conselho amoroso e inspirador para uma filha, vindo de um pai que a ama incondicionalmente. O conselho deve focar na import√¢ncia de amar verdadeiramente, de construir uma fam√≠lia feliz, de encontrar a felicidade na vida, de nunca esquecer a f√© e de saber que o pai estar√° sempre l√° para a apoiar, mesmo quando n√£o estiver presente fisicamente. O conselho deve ser breve e tocante.";
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    generatedAdvice.textContent = text;
                } else {
                    generatedAdvice.textContent = "N√£o foi poss√≠vel gerar um conselho neste momento. Tente novamente.";
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini:", error);
                generatedAdvice.textContent = "Ocorreu um erro ao gerar o conselho. Por favor, tente mais tarde.";
            } finally {
                loadingIndicator.classList.add('hidden');
                generateAdviceBtn.disabled = false;
            }
        }

        async function sendChatMessage(initialPrompt = '') {
            const userMessage = chatInput.value.trim();
            if (userMessage === "" && initialPrompt === "") return;

            if (userMessage !== "") {
                addMessageToChat(userMessage, 'user');
                chatInput.value = '';
            }
            chatBox.scrollTop = chatBox.scrollHeight;

            chatLoadingIndicator.classList.remove('hidden');
            sendChatBtn.disabled = true;

            let basePrompt = `Voc√™ √© o papai da Sophia. Responda √† Sophia com muito carinho, amor, motivando-a a sempre fazer a coisa certa, a servir a Cristo e a Deus, e reforce o quanto a ama com lindas palavras que apertam o cora√ß√£o. O papai sempre estar√° com ela. Em suas respostas, refira-se a si mesmo como "Papai".`;
           
            let finalUserMessage = userMessage;

            if (currentChatMode === 'aconselhar') {
                basePrompt += ` D√™ um conselho s√°bio e amoroso sobre a pergunta dela, com um tom mais profundo e reflexivo.`;
            } else if (currentChatMode === 'conversar') {
                basePrompt += ` Sua principal miss√£o √© ser um ouvinte atento e um pai amoroso. Tente identificar se a Sophia est√° triste, preocupada, com saudades ou precisando desabafar. Se ela demonstrar alguma emo√ß√£o negativa ou saudade, responda com empatia, encoraje-a a expressar mais seus sentimentos ("desabafar"), ofere√ßa conforto, e gentilmente a ajude a encontrar um caminho para a melhoria ou a distraia com carinho. Sempre reforce o amor incondicional do papai e a presen√ßa de Deus. Mantenha a conversa leve e de apoio, fazendo perguntas que incentivem o di√°logo. Se a mensagem for uma sauda√ß√£o simples, responda com uma sauda√ß√£o carinhosa e uma pergunta sobre o dia dela.`;
            }

            if (specialInstruction) {
                basePrompt += ` Instru√ß√£o especial do papai: "${specialInstruction}".`;
            }
           
            const fullPrompt = `${basePrompt} A Sophia disse: "${finalUserMessage}"`;

            let chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiResponse = result.candidates[0].content.parts[0].text;
                    addMessageToChat(aiResponse, 'ai');
                } else {
                    addMessageToChat("Desculpe, filha. O papai n√£o conseguiu pensar numa resposta agora. Tente novamente.", 'ai');
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini para o chat:", error);
                addMessageToChat("Ocorreu um erro na nossa conversa, filha. Por favor, tente mais tarde.", 'ai');
            } finally {
                chatLoadingIndicator.classList.add('hidden');
                sendChatBtn.disabled = false;
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        function addMessageToChat(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', type);
            messageDiv.textContent = message;
            chatBox.appendChild(messageDiv);
        }

        function setChatMode(mode) {
            currentChatMode = mode;
            // Limpa o chat box ao mudar de modo para uma nova intera√ß√£o
            chatBox.innerHTML = '';
            specialInstruction = ""; // Limpa a instru√ß√£o especial ao mudar de modo

            modeAconselharBtn.classList.remove('bg-blue-800', 'text-white');
            modeConversarBtn.classList.remove('bg-green-800', 'text-white');

            if (mode === 'aconselhar') {
                modeAconselharBtn.classList.add('bg-blue-800', 'text-white');
                addMessageToChat("Ol√°, minha filha. Em que o papai pode te aconselhar hoje? Conte-me o que est√° no seu cora√ß√£o.", 'ai');
            } else if (mode === 'conversar') {
                modeConversarBtn.classList.add('bg-green-800', 'text-white');
                // Inicia a conversa com uma sauda√ß√£o e pergunta no modo conversar
                sendChatMessage("Oi, papai! Tudo bem?", true); // O segundo argumento 'true' indica que √© um prompt inicial da AI
            }
        }

        // Configura√ß√£o do reconhecimento de voz
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false; // N√£o cont√≠nuo, para detectar uma √∫nica frase
            recognition.lang = 'pt-BR'; // Idioma portugu√™s do Brasil
            recognition.interimResults = false; // N√£o mostrar resultados provis√≥rios

            recognition.onstart = function() {
                voiceStatus.textContent = 'A ouvir... Diga "Papai Mestre"';
                voiceStatus.classList.remove('hidden');
                voiceActivateBtn.disabled = true;
                voiceActivateBtn.textContent = 'A Ouvir...';
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                voiceStatus.textContent = 'Detetado: ' + transcript;

                if (transcript.toLowerCase().includes('papai mestre')) {
                    specialInstructionArea.classList.remove('hidden');
                    voiceStatus.textContent = 'Palavra-chave detetada! Insira a instru√ß√£o especial.';
                } else {
                    voiceStatus.textContent = 'Palavra-chave n√£o detetada. Tente novamente.';
                }
            };

            recognition.onerror = function(event) {
                console.error('Erro no reconhecimento de voz:', event.error);
                voiceStatus.textContent = 'Erro no reconhecimento de voz. Tente novamente.';
                voiceActivateBtn.disabled = false;
                voiceActivateBtn.textContent = 'Ativar Voz (Diga "Papai Mestre")';
                specialInstructionArea.classList.add('hidden');
            };

            recognition.onend = function() {
                voiceActivateBtn.disabled = false;
                voiceActivateBtn.textContent = 'Ativar Voz (Diga "Papai Mestre")';
                if (!specialInstructionArea.classList.contains('hidden')) {
                    voiceStatus.textContent = 'Pronto para a instru√ß√£o especial.';
                } else {
                    voiceStatus.classList.add('hidden');
                }
            };

            voiceActivateBtn.addEventListener('click', () => {
                recognition.start();
            });

            specialInstructionInput.addEventListener('input', () => {
                specialInstruction = specialInstructionInput.value.trim();
            });

        } else {
            voiceActivateBtn.textContent = 'Reconhecimento de voz n√£o suportado neste navegador.';
            voiceActivateBtn.disabled = true;
        }


        document.addEventListener('DOMContentLoaded', () => {
            showStory('sophia');
            generateAdviceBtn.addEventListener('click', generateAdvice);
            sendChatBtn.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });

            // Definir o modo inicial e adicionar o listener para os bot√µes de modo
            setChatMode('conversar'); // Define o modo inicial como 'conversar'
            modeAconselharBtn.addEventListener('click', () => setChatMode('aconselhar'));
            modeConversarBtn.addEventListener('click', () => setChatMode('conversar'));
        });
    </script>

</body>
</html>